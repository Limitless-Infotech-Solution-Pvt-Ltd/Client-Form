<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Requirements Form - Limitless Infotech Solution's PVT LTD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-step {
            display: none;
            animation: fadeIn 0.5s;
        }
        .form-step.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .progress-bar-fill {
            transition: width 0.4s ease-in-out;
        }
        .form-container {
            max-width: 800px;
            margin: auto;
        }
        #successMessage, #submissionError {
            display: none;
        }
        /* Custom styles for invalid fields */
        .invalid-field {
            border-color: #ef4444; /* red-500 */
            box-shadow: 0 0 0 2px #fecaca; /* red-200 */
        }
        .error-message {
            color: #dc2626; /* red-600 */
            font-size: 0.875rem; /* text-sm */
            margin-top: 0.25rem;
        }
        .char-counter {
            font-size: 0.75rem;
            color: #6b7280;
            text-align: right;
        }
        .spinner {
            animation: spin 1s linear infinite;
            display: inline-block;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="form-container bg-white shadow-lg rounded-lg my-10 p-8">
        <div id="successMessage" class="text-center">
            <svg class="mx-auto h-12 w-12 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="mt-4 text-2xl font-bold text-gray-900">Submission Successful!</h3>
            <p class="mt-2 text-gray-600">Thank you for providing your project requirements. We will get back to you shortly.</p>
            <div class="mt-6">
                <button id="downloadCsvBtn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-md hover:bg-blue-700 transition duration-300">
                    Download Submission as CSV
                </button>
            </div>
             <p class="mt-4 text-xs text-gray-500">For automatic email notifications, this form would need to be connected to a backend service.</p>
        </div>
        <div id="submissionError" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-md">
            <p class="font-bold">Submission Failed</p>
            <p>An unexpected error occurred. Please try submitting the form again.</p>
        </div>


        <!-- Branding Header -->
        <div id="brandingHeader" class="text-center mb-8">
            <img src="https://i.imgur.com/OD432yM.png" alt="Limitless Infotech Solution's PVT LTD Logo" class="mx-auto h-24 w-auto" onerror="this.onerror=null;this.src='https://placehold.co/200x80/000000/FFFFFF?text=Logo';">
            <h1 class="text-3xl font-bold text-gray-900 mt-4">Limitless Infotech Solution's PVT LTD</h1>
            <p class="text-gray-600 mt-2 italic">"Where Innovation Meets Execution. Empowering Businesses with Technology that is Secure, Unique, and Limitless."</p>
        </div>

        <div id="form-content">
            <!-- Progress Bar -->
            <div class="mb-8">
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full progress-bar-fill" style="width: 20%"></div>
                </div>
                <div id="stepIndicator" class="text-center text-sm text-gray-600 mt-2">Step 1 of 5</div>
            </div>


            <form id="requirementsForm" action="#" method="POST" novalidate>

                <!-- Step 1: Contact Information -->
                <div id="step-1" class="form-step active">
                    <h2 class="text-2xl font-semibold text-gray-800 border-l-4 border-blue-500 pl-4 mb-6">Contact Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="fullName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                            <input type="text" id="fullName" name="fullName" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <p class="error-message" aria-live="polite"></p>
                        </div>
                        <div>
                            <label for="companyName" class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                            <input type="text" id="companyName" name="companyName" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                            <input type="email" id="email" name="email" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                             <p class="error-message" aria-live="polite"></p>
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                            <input type="tel" id="phone" name="phone" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>

                <!-- Step 2: Project Type -->
                <div id="step-2" class="form-step">
                    <h2 class="text-2xl font-semibold text-gray-800 border-l-4 border-blue-500 pl-4 mb-6">Service & Project Details</h2>
                    <div class="mb-8">
                        <h3 class="text-lg font-medium text-gray-800 mb-2">What service are you interested in?</h3>
                        <div id="projectTypeContainer" class="space-y-4">
                            <div class="flex items-center"><input type="radio" id="software" name="projectType" value="software" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"><label for="software" class="ml-3 block text-sm font-medium text-gray-700">Software Development</label></div>
                            <div class="flex items-center"><input type="radio" id="hardware" name="projectType" value="hardware" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"><label for="hardware" class="ml-3 block text-sm font-medium text-gray-700">Hardware Development</label></div>
                            <div class="flex items-center"><input type="radio" id="website" name="projectType" value="website" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"><label for="website" class="ml-3 block text-sm font-medium text-gray-700">Website Development</label></div>
                            <div class="flex items-center"><input type="radio" id="mobile" name="projectType" value="mobile" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"><label for="mobile" class="ml-3 block text-sm font-medium text-gray-700">Mobile App Development</label></div>
                            <div class="flex items-center"><input type="radio" id="other" name="projectType" value="other" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"><label for="other" class="ml-3 block text-sm font-medium text-gray-700">Other</label></div>
                        </div>
                        <p class="error-message" id="projectTypeError" aria-live="polite"></p>
                    </div>
                    
                    <div id="projectDetails" class="mt-6">
                        <!-- Conditional sections will be injected here -->
                    </div>
                </div>

                <!-- Step 3: Advanced Details -->
                <div id="step-3" class="form-step">
                    <h2 class="text-2xl font-semibold text-gray-800 border-l-4 border-blue-500 pl-4 mb-6">Advanced Details</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="targetAudience" class="block text-sm font-medium text-gray-700 mb-1">Who is the target audience/user?</label>
                            <textarea id="targetAudience" name="targetAudience" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-md" placeholder="Describe their demographics, needs, and technical skills." maxlength="500"></textarea>
                            <div class="char-counter">0 / 500</div>
                        </div>
                        <div>
                            <label for="competitors" class="block text-sm font-medium text-gray-700 mb-1">Who are your main competitors?</label>
                            <textarea id="competitors" name="competitors" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-md" placeholder="List existing similar products. What makes yours different?" maxlength="500"></textarea>
                            <div class="char-counter">0 / 500</div>
                        </div>
                        <div>
                            <label for="technicalRequirements" class="block text-sm font-medium text-gray-700 mb-1">Specific Technical Requirements (if any)</label>
                            <textarea id="technicalRequirements" name="technicalRequirements" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-md" placeholder="e.g., Preferred language, database, hosting." maxlength="500"></textarea>
                            <div class="char-counter">0 / 500</div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Budget, Timeline & Final Details -->
                <div id="step-4" class="form-step">
                     <h2 class="text-2xl font-semibold text-gray-800 border-l-4 border-blue-500 pl-4 mb-6">Budget & Timeline</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div>
                            <label for="budget" class="block text-sm font-medium text-gray-700 mb-1">Estimated Budget</label>
                            <div class="flex">
                                <select id="currency" name="currency" class="px-4 py-2 border border-r-0 border-gray-300 rounded-l-md focus:ring-blue-500 focus:border-blue-500 bg-gray-50"></select>
                                <select id="budget" name="budget" class="w-full px-4 py-2 border border-gray-300 rounded-r-md focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select a range</option>
                                    <option value="<5000">&lt; 5,000</option>
                                    <option value="5000-10000">5,000 - 10,000</option>
                                    <option value="10000-25000">10,000 - 25,000</option>
                                    <option value="25000-50000">25,000 - 50,000</option>
                                    <option value=">50000">&gt; 50,000</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="timeline" class="block text-sm font-medium text-gray-700 mb-1">Desired Completion Date</label>
                            <input type="date" id="timeline" name="timeline" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>

                    <h2 class="text-2xl font-semibold text-gray-800 border-l-4 border-blue-500 pl-4 mb-6">Final Details</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="howHeard" class="block text-sm font-medium text-gray-700 mb-1">How did you hear about us?</label>
                            <select id="howHeard" name="howHeard" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                                <option value="">Select an option</option>
                                <option>Google / Search Engine</option>
                                <option>Social Media (LinkedIn, Facebook, etc.)</option>
                                <option>Referral / Word of Mouth</option>
                                <option>Advertisement</option>
                                <option value="Other">Other</option>
                            </select>
                            <div id="howHeardOtherContainer" class="mt-2 hidden">
                                <label for="howHeardOther" class="block text-sm font-medium text-gray-700 mb-1">Please specify:</label>
                                <input type="text" id="howHeardOther" name="howHeardOther" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                        <div>
                            <label for="files" class="block text-sm font-medium text-gray-700 mb-1">Attach any relevant files</label>
                            <input type="file" id="files" name="files" multiple class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                            <div id="file-list" class="mt-2 text-sm text-gray-600"></div>
                        </div>
                        <div>
                            <label for="comments" class="block text-sm font-medium text-gray-700 mb-1">Anything else we should know?</label>
                            <textarea id="comments" name="comments" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-md" maxlength="1000"></textarea>
                            <div class="char-counter">0 / 1000</div>
                        </div>
                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input id="nda" name="nda" type="checkbox" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="nda" class="font-medium text-gray-700">Request an NDA</label>
                                <p class="text-gray-500">Check this box if you would like us to sign a Non-Disclosure Agreement.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Review & Submit -->
                <div id="step-5" class="form-step">
                    <h2 class="text-2xl font-semibold text-gray-800 border-l-4 border-blue-500 pl-4 mb-6">Review Your Submission</h2>
                    <p class="text-gray-600 mb-6">Please review the information below before submitting. Click "Edit" to jump back to a section.</p>
                    <div id="review-content" class="space-y-4 bg-gray-50 p-6 rounded-lg">
                        <!-- Review content will be dynamically generated here -->
                    </div>
                </div>


                <!-- Navigation Buttons -->
                <div class="mt-8 pt-5 border-t border-gray-200">
                    <div class="flex justify-between">
                        <button type="button" id="prevBtn" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-md hover:bg-gray-300 transition duration-300">Previous</button>
                        <button type="button" id="nextBtn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-md hover:bg-blue-700 transition duration-300">Next</button>
                        <button type="submit" id="submitBtn" class="bg-green-600 text-white font-bold py-2 px-6 rounded-md hover:bg-green-700 transition duration-300 hidden items-center justify-center">Submit Request</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Templates for conditional project details sections -->
    <template id="software-template">
        <div class="form-section active space-y-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Software Project Details</h3>
            <div><label for="softwareProjectName" class="block text-sm font-medium text-gray-700 mb-1">Project Name/Title</label><input type="text" id="softwareProjectName" name="softwareProjectName" class="w-full px-4 py-2 border border-gray-300 rounded-md"></div>
            <div><label for="softwareDescription" class="block text-sm font-medium text-gray-700 mb-1">Detailed Project Description & Core Functionality</label><textarea id="softwareDescription" name="softwareDescription" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-md" maxlength="1000"></textarea><div class="char-counter">0 / 1000</div></div>
            <div><label class="block text-sm font-medium text-gray-700 mb-2">Target Platforms</label><div class="space-y-2"><div class="flex items-center"><input type="checkbox" name="platform" value="windows" class="h-4 w-4"><span class="ml-2">Windows</span></div><div class="flex items-center"><input type="checkbox" name="platform" value="macos" class="h-4 w-4"><span class="ml-2">macOS</span></div><div class="flex items-center"><input type="checkbox" name="platform" value="linux" class="h-4 w-4"><span class="ml-2">Linux</span></div><div class="flex items-center"><input type="checkbox" name="platform" value="web" class="h-4 w-4"><span class="ml-2">Web-based</span></div></div></div>
            <div><label for="integrations" class="block text-sm font-medium text-gray-700 mb-1">Any required integrations with other software/APIs?</label><input type="text" id="integrations" name="integrations" class="w-full px-4 py-2 border border-gray-300 rounded-md" placeholder="e.g., Stripe, Google Maps, Salesforce"></div>
        </div>
    </template>
    <template id="hardware-template">
         <div class="form-section active space-y-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Hardware Project Details</h3>
            <div><label for="hardwareProjectName" class="block text-sm font-medium text-gray-700 mb-1">Product Name/Concept</label><input type="text" id="hardwareProjectName" name="hardwareProjectName" class="w-full px-4 py-2 border border-gray-300 rounded-md"></div>
            <div><label for="hardwareDescription" class="block text-sm font-medium text-gray-700 mb-1">Detailed Product Description & Use Case</label><textarea id="hardwareDescription" name="hardwareDescription" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-md" maxlength="1000"></textarea><div class="char-counter">0 / 1000</div></div>
            <div><label for="prototyping" class="block text-sm font-medium text-gray-700 mb-1">Stage of Development</label><select id="prototyping" name="prototyping" class="w-full px-4 py-2 border border-gray-300 rounded-md"><option>Select stage</option><option>Concept/Idea</option><option>Prototype exists</option><option>Ready for manufacturing</option></select></div>
            <div><label for="certifications" class="block text-sm font-medium text-gray-700 mb-1">Required Certifications</label><input type="text" id="certifications" name="certifications" class="w-full px-4 py-2 border border-gray-300 rounded-md" placeholder="e.g., FCC, CE, UL"></div>
        </div>
    </template>
    <template id="website-template">
        <div class="form-section active space-y-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Website Project Details</h3>
            <div><label for="websitePurpose" class="block text-sm font-medium text-gray-700 mb-1">Primary Purpose of the Website</label><input type="text" id="websitePurpose" name="websitePurpose" class="w-full px-4 py-2 border border-gray-300 rounded-md" placeholder="e.g., E-commerce, Lead Generation, Portfolio"></div>
            <div><label for="websiteFeatures" class="block text-sm font-medium text-gray-700 mb-1">Must-Have Features</label><textarea id="websiteFeatures" name="websiteFeatures" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-md" placeholder="e.g., User accounts, Payment gateway, Live chat, Blog" maxlength="1000"></textarea><div class="char-counter">0 / 1000</div></div>
            <div><label for="designPreference" class="block text-sm font-medium text-gray-700 mb-1">Design Preferences (optional)</label><input type="text" id="designPreference" name="designPreference" class="w-full px-4 py-2 border border-gray-300 rounded-md" placeholder="e.g., Link to a site you like, preferred colors"></div>
        </div>
    </template>
    <template id="mobile-template">
        <div class="form-section active space-y-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Mobile App Project Details</h3>
            <div><label for="mobileProjectName" class="block text-sm font-medium text-gray-700 mb-1">App Name/Concept</label><input type="text" id="mobileProjectName" name="mobileProjectName" class="w-full px-4 py-2 border border-gray-300 rounded-md"></div>
            <div><label class="block text-sm font-medium text-gray-700 mb-2">Target Platforms</label><div class="space-y-2"><div class="flex items-center"><input type="checkbox" name="mobile_platform" value="ios" class="h-4 w-4"><span class="ml-2">iOS (iPhone/iPad)</span></div><div class="flex items-center"><input type="checkbox" name="mobile_platform" value="android" class="h-4 w-4"><span class="ml-2">Android (Phone/Tablet)</span></div><div class="flex items-center"><input type="checkbox" name="mobile_platform" value="both" class="h-4 w-4"><span class="ml-2">Both</span></div></div></div>
            <div><label for="monetization" class="block text-sm font-medium text-gray-700 mb-1">Monetization Strategy</label><input type="text" id="monetization" name="monetization" class="w-full px-4 py-2 border border-gray-300 rounded-md" placeholder="e.g., Paid app, In-app purchases, Ads, Subscription"></div>
        </div>
    </template>
    <template id="other-template">
        <div class="form-section active">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Other Project Details</h3>
            <div><label for="otherDescription" class="block text-sm font-medium text-gray-700 mb-1">Please describe your project in detail</label><textarea id="otherDescription" name="otherDescription" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-md" maxlength="1000"></textarea><div class="char-counter">0 / 1000</div></div>
        </div>
    </template>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let currentStep = 1;
            const totalSteps = 5;
            const form = document.getElementById('requirementsForm');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            const progressBar = document.getElementById('progressBar');
            const stepIndicator = document.getElementById('stepIndicator');
            let lastSubmissionData = null;

            const showStep = (step) => {
                document.querySelectorAll('.form-step').forEach(el => el.classList.remove('active'));
                document.getElementById(`step-${step}`).classList.add('active');
                
                progressBar.style.width = `${(step / totalSteps) * 100}%`;
                stepIndicator.textContent = `Step ${step} of ${totalSteps}`;

                prevBtn.style.display = step === 1 ? 'none' : 'inline-block';
                nextBtn.style.display = step === totalSteps ? 'none' : 'inline-block';
                submitBtn.style.display = step === totalSteps ? 'inline-block' : 'none';
                
                document.getElementById('submissionError').style.display = 'none';

                if (step === totalSteps) {
                    generateReview();
                }
            };

            const validateStep = (step) => {
                let isValid = true;
                const currentStepEl = document.getElementById(`step-${step}`);
                
                currentStepEl.querySelectorAll('.invalid-field').forEach(el => el.classList.remove('invalid-field'));
                currentStepEl.querySelectorAll('.error-message').forEach(el => el.textContent = '');

                const inputs = currentStepEl.querySelectorAll('input[required], select[required], textarea[required]');
                inputs.forEach(input => {
                    if (!input.value.trim()) {
                        isValid = false;
                        input.classList.add('invalid-field');
                        const errorEl = input.closest('div').querySelector('.error-message');
                        if(errorEl) errorEl.textContent = 'This field is required.';
                    }
                    if (input.type === 'email' && input.value.trim() && !/^\S+@\S+\.\S+$/.test(input.value)) {
                        isValid = false;
                        input.classList.add('invalid-field');
                        const errorEl = input.closest('div').querySelector('.error-message');
                        if(errorEl) errorEl.textContent = 'Please enter a valid email address.';
                    }
                });

                if (step === 2) {
                    const projectType = form.querySelector('input[name="projectType"]:checked');
                    if (!projectType) {
                        isValid = false;
                        document.getElementById('projectTypeError').textContent = 'Please select a service type.';
                    }
                }

                return isValid;
            };

            nextBtn.addEventListener('click', () => {
                if (validateStep(currentStep)) {
                    if (currentStep < totalSteps) {
                        currentStep++;
                        showStep(currentStep);
                    }
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                }
            });

            const setupEventListeners = () => {
                form.querySelectorAll('input[name="projectType"]').forEach(radio => {
                    radio.addEventListener('change', function () {
                        const projectDetailsContainer = document.getElementById('projectDetails');
                        projectDetailsContainer.innerHTML = '';
                        const templateId = `${this.value}-template`;
                        const template = document.getElementById(templateId);
                        if (template) {
                            projectDetailsContainer.appendChild(template.content.cloneNode(true));
                            setupEventListeners();
                        }
                        saveFormData();
                    });
                });

                form.querySelectorAll('textarea[maxlength]').forEach(textarea => {
                    const counter = textarea.nextElementSibling;
                    const updateCounter = () => {
                        const len = textarea.value.length;
                        const max = textarea.getAttribute('maxlength');
                        counter.textContent = `${len} / ${max}`;
                    };
                    textarea.removeEventListener('input', updateCounter); // Prevent duplicate listeners
                    textarea.addEventListener('input', updateCounter);
                    updateCounter();
                });

                const howHeardSelect = document.getElementById('howHeard');
                if (howHeardSelect) {
                    howHeardSelect.addEventListener('change', function() {
                        document.getElementById('howHeardOtherContainer').style.display = this.value === 'Other' ? 'block' : 'none';
                    });
                }
                
                const fileInput = document.getElementById('files');
                if(fileInput) {
                    fileInput.addEventListener('change', function() {
                        const fileList = document.getElementById('file-list');
                        fileList.innerHTML = '';
                        if (this.files.length > 0) {
                            Array.from(this.files).forEach(file => {
                                const fileItem = document.createElement('div');
                                fileItem.textContent = file.name;
                                fileList.appendChild(fileItem);
                            });
                        }
                    });
                }
            };
            
            const currencySelect = document.getElementById('currency');
            const currencies = { "USD": "$", "EUR": "€", "JPY": "¥", "GBP": "£", "INR": "₹", "AUD": "$", "CAD": "$", "CHF": "Fr", "CNY": "¥", "SEK": "kr", "NZD": "$" };
            for (const code in currencies) {
                currencySelect.add(new Option(`${code} (${currencies[code]})`, code));
            }
            currencySelect.value = 'USD';

            const saveFormData = () => {
                const formData = new FormData(form);
                const data = {};
                for (let [key, value] of formData.entries()) {
                    const element = form.elements[key];
                    if(element) {
                        if (element.type === 'checkbox') {
                            if (!data[key]) data[key] = [];
                            if (element.checked) data[key].push(value);
                        } else if (element.type === 'radio') {
                             if (element.checked) data[key] = value;
                        } else {
                            data[key] = value;
                        }
                    }
                }
                sessionStorage.setItem('clientFormData', JSON.stringify(data));
            };

            const loadFormData = () => {
                const data = JSON.parse(sessionStorage.getItem('clientFormData'));
                if (!data) return;

                for (const key in data) {
                    const element = form.elements[key];
                    if (element) {
                        if (element.type === 'radio') {
                            const radioToSelect = document.querySelector(`input[name="${key}"][value="${data[key]}"]`);
                            if (radioToSelect) {
                                radioToSelect.checked = true;
                                radioToSelect.dispatchEvent(new Event('change'));
                            }
                        } else if (element.type === 'checkbox') {
                            if (Array.isArray(data[key])) {
                                data[key].forEach(val => {
                                    const chk = document.querySelector(`input[name="${key}"][value="${val}"]`);
                                    if (chk) chk.checked = true;
                                });
                            } else if (data[key]) {
                                element.checked = true;
                            }
                        } else {
                            element.value = data[key];
                        }
                    }
                }
                document.getElementById('howHeard').dispatchEvent(new Event('change'));
                
                setTimeout(() => {
                    for (const key in data) {
                        const element = form.elements[key];
                        if (element && element.closest('#projectDetails')) {
                            element.value = data[key];
                            if(element.tagName === 'TEXTAREA') element.dispatchEvent(new Event('input'));
                        }
                    }
                }, 150);
            };
            
            form.addEventListener('input', saveFormData);
            
            const generateReview = () => {
                const reviewContent = document.getElementById('review-content');
                reviewContent.innerHTML = '';
                const formData = new FormData(form);

                const createReviewSection = (title, step) => `<div class="p-4 border rounded-lg bg-white mb-4"><div class="flex justify-between items-center mb-2"><h4 class="font-bold text-lg">${title}</h4><button type="button" class="text-blue-600 hover:underline text-sm edit-btn" data-step="${step}">Edit</button></div><div class="review-section-content space-y-2"></div></div>`;
                reviewContent.innerHTML = [1, 2, 3, 4].map(i => createReviewSection(document.querySelector(`#step-${i} h2`).textContent, i)).join('');

                const fieldLabels = {
                    fullName: { label: "Full Name", step: 1 }, companyName: { label: "Company Name", step: 1 }, email: { label: "Email", step: 1 }, phone: { label: "Phone Number", step: 1 },
                    projectType: { label: "Service Type", step: 2 }, softwareProjectName: { label: "Project Name", step: 2 }, softwareDescription: { label: "Project Description", step: 2 },
                    platform: { label: "Target Platforms", step: 2 }, integrations: { label: "Integrations", step: 2 }, hardwareProjectName: { label: "Product Name", step: 2 },
                    hardwareDescription: { label: "Product Description", step: 2 }, prototyping: { label: "Development Stage", step: 2 }, certifications: { label: "Certifications", step: 2 },
                    websitePurpose: { label: "Website Purpose", step: 2 }, websiteFeatures: { label: "Desired Features", step: 2 }, designPreference: { label: "Design Preferences", step: 2 },
                    mobileProjectName: { label: "App Name", step: 2 }, mobile_platform: { label: "Mobile Platforms", step: 2 }, monetization: { label: "Monetization", step: 2 },
                    otherDescription: { label: "Project Description", step: 2 }, 
                    targetAudience: { label: "Target Audience", step: 3 }, competitors: { label: "Competitors", step: 3 }, technicalRequirements: { label: "Tech Requirements", step: 3 },
                    budget: { label: "Budget", step: 4 }, currency: { label: "Currency", step: 4 }, timeline: { label: "Timeline", step: 4 },
                    howHeard: { label: "How did you hear about us?", step: 4 }, howHeardOther: { label: "Source (Other)", step: 4 }, nda: { label: "NDA Requested", step: 4 }, comments: { label: "Additional Comments", step: 4 },
                    files: { label: "Attached Files", step: 4 }
                };

                for (let [key, value] of formData.entries()) {
                    if (fieldLabels[key] && value) {
                        const step = fieldLabels[key].step;
                        const container = reviewContent.querySelectorAll('.review-section-content')[step - 1];
                        let displayValue = value.toString().replace(/\n/g, '<br>');
                        let displayKey = fieldLabels[key].label;

                        if (key === 'files' && form.elements[key].files.length > 0) {
                            displayValue = Array.from(form.elements[key].files).map(f => f.name).join('<br>');
                        } else if (key === 'files') continue;
                        if (key === 'howHeard' && value === 'Other') continue;
                        if (key === 'nda') displayValue = 'Yes';

                        if (form.elements[key] && form.elements[key].type === 'checkbox' && key !== 'nda') {
                            if (!container.querySelector(`[data-key="${key}"]`)) {
                                const values = formData.getAll(key).join(', ');
                                container.insertAdjacentHTML('beforeend', `<div data-key="${key}"><strong>${displayKey}:</strong><p class="text-gray-700 pl-2 break-words">${values}</p></div>`);
                            }
                        } else {
                             container.insertAdjacentHTML('beforeend', `<div><strong>${displayKey}:</strong><p class="text-gray-700 pl-2 break-words">${displayValue}</p></div>`);
                        }
                    }
                }
                
                reviewContent.querySelectorAll('.edit-btn').forEach(btn => {
                   btn.addEventListener('click', function() {
                       currentStep = parseInt(this.getAttribute('data-step'));
                       showStep(currentStep);
                   })
                });
            };

            const convertToCSV = (formData) => {
                const headers = [];
                const row = [];
                const fieldLabels = {
                    fullName: "Full Name", companyName: "Company Name", email: "Email", phone: "Phone Number", projectType: "Service Type", softwareProjectName: "Project Name", softwareDescription: "Project Description", platform: "Target Platforms", integrations: "Integrations", hardwareProjectName: "Product Name", hardwareDescription: "Product Description", prototyping: "Development Stage", certifications: "Certifications", websitePurpose: "Website Purpose", websiteFeatures: "Desired Features", designPreference: "Design Preferences", mobileProjectName: "App Name", mobile_platform: "Mobile Platforms", monetization: "Monetization", otherDescription: "Project Description", targetAudience: "Target Audience", competitors: "Competitors", technicalRequirements: "Tech Requirements", budget: "Budget", currency: "Currency", timeline: "Timeline", howHeard: "How did you hear about us?", howHeardOther: "Source (Other)", nda: "NDA Requested", comments: "Additional Comments", files: "Attached Files"
                };

                for(const key in fieldLabels) {
                    headers.push(fieldLabels[key]);
                    let value = formData.get(key);
                    if(form.elements[key] && form.elements[key].type === 'checkbox') {
                        value = formData.getAll(key).join(', ');
                    }
                    if(key === 'files') {
                        value = Array.from(form.elements[key].files).map(f => f.name).join(', ');
                    }
                    row.push(`"${(value || '').toString().replace(/"/g, '""')}"`);
                }
                
                return `${headers.join(',')}\n${row.join(',')}`;
            };

            document.getElementById('downloadCsvBtn').addEventListener('click', () => {
                if (lastSubmissionData) {
                    const csv = convertToCSV(lastSubmissionData);
                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement("a");
                    const url = URL.createObjectURL(blob);
                    link.setAttribute("href", url);
                    link.setAttribute("download", `submission-${Date.now()}.csv`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            });

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                if (!validateStep(currentStep) && currentStep !== totalSteps) return;

                submitBtn.innerHTML = '<span class="spinner"></span>Submitting...';
                submitBtn.disabled = true;
                prevBtn.disabled = true;

                setTimeout(() => {
                    const isSuccess = Math.random() > 0.1; 
                    if (isSuccess) {
                        lastSubmissionData = new FormData(form);
                        document.getElementById('brandingHeader').style.display = 'none';
                        document.getElementById('form-content').style.display = 'none';
                        document.getElementById('successMessage').style.display = 'block';
                        window.scrollTo(0, 0);
                        sessionStorage.removeItem('clientFormData');
                    } else {
                        document.getElementById('submissionError').style.display = 'block';
                        submitBtn.innerHTML = 'Submit Request';
                        submitBtn.disabled = false;
                        prevBtn.disabled = false;
                        window.scrollTo(0, 0);
                    }
                }, 1500);
            });

            setupEventListeners();
            loadFormData();
            showStep(currentStep);
        });
    </script>

</body>
</html>
